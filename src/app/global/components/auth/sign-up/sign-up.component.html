<div class="close-button-wrapper">
  <span class="company-name">Inaluma Make-Up</span>
  <button mat-mini-fab (click)="home()" color="warn"><mat-icon>close</mat-icon></button>
</div>
<div class="main-content">
  <mat-card class="content">
    <div class="body-content">
      <div class="company-info">
        <div class="logo"><img src="/assets/images/carrinho_vazio.jpg"  class="circle responsive-img"/></div>
        <h1 class="title">Nova Conta</h1>
        <h3 class="hint">{{sectionTitle}}</h3>
      </div>
      <form [formGroup]="signUpForm" class="sign-up-form" #form>
        <div formGroupName="person" #formSection class="form-section" data-sectionTitle="Dados Pessoais">
          <!-- Name -->
          <mat-form-field appearance="outline">
            <mat-label>Nome</mat-label>
            <input type="text" matInput formControlName="name">
            <mat-error *ngIf="getPersonControls('name').hasError('required')">Campo obrigatório</mat-error>
          </mat-form-field>
          <!-- Surname -->
          <mat-form-field appearance="outline">
            <mat-label>Sobrenome</mat-label>
            <input type="text" matInput formControlName="surname">
            <mat-error *ngIf="getPersonControls('surname').hasError('required')">Campo obrigatório</mat-error>
          </mat-form-field>
          <!-- Gender -->
          <div id="gender-section" formGroupName="gender">
            <mat-form-field appearance="outline">
              <mat-label>Gênero</mat-label>
              <mat-select formControlName="id">
                <mat-option></mat-option>
                <mat-option *ngFor="let g of genders" [value]="g.id">{{g.name}}</mat-option>
              </mat-select>
              <mat-error *ngIf="getGenderControls('id').hasError('required')">Campo obrigatório</mat-error>
            </mat-form-field>
          </div>
          <mat-form-field appearance="outline">
            <mat-label>Contacto</mat-label>
            <input type="text" matInput formControlName="contact" />
            <mat-error *ngIf="getPersonControls('contact').hasError('required')">Campo obrigatório</mat-error>
          </mat-form-field>
        </div>
        <div formGroupName="credentials" #formSection class="form-section" data-sectionTitle="Credenciais">
          <!-- username -->
          <mat-form-field appearance="outline">
            <mat-label>Nome de Utilisador</mat-label>
            <input type="text" matInput formControlName="username">
            <mat-error *ngIf="getCredentialsControls('username').hasError('required')">Campo obrigatório</mat-error>
            <mat-error *ngIf="getCredentialsControls('username').hasError('minLength')">Insira no mínimo 4 caracteres</mat-error>
            <mat-error *ngIf="getCredentialsControls('username').hasError('usernameTaken')">Este nome de utilizador não está disponível</mat-error>
          </mat-form-field>
          <!-- password -->
          <mat-form-field appearance="outline">
            <mat-label>Senha</mat-label>
            <input [type]="inputType" matInput formControlName="password">
            <button mat-icon-button matSuffix (click)="toggleHidden()">
              <mat-icon>
                <ng-container *ngIf="isHidden">visibility</ng-container>
                <ng-container *ngIf="!isHidden">visibility_off</ng-container>
              </mat-icon>
            </button>
            <mat-error *ngIf="getCredentialsControls('password').hasError('required')">Campo obrigatório</mat-error>
            <mat-error *ngIf="getCredentialsControls('password').hasError('minlength')">Insira no mínimo 6 caracteres</mat-error>
            <mat-error *ngIf="getCredentialsControls('password').hasError('emptyString')">Senha vazia</mat-error>
            <mat-error *ngIf="getCredentialsControls('password').hasError('usernameTaken')">Indisponível</mat-error>
          </mat-form-field>
          <!-- confirm password -->
          <mat-form-field appearance="outline">
            <mat-label>Confirmar Senha</mat-label>
            <input [type]="inputType" matInput formControlName="confirm_password">
            <button mat-icon-button matSuffix (click)="toggleHidden()">
              <mat-icon>
                <ng-container *ngIf="isHidden">visibility</ng-container>
                <ng-container *ngIf="!isHidden">visibility_off</ng-container>
              </mat-icon>
            </button>
            <mat-error *ngIf="getCredentialsControls('confirm_password').hasError('fieldsMismatch')">As senhas são diferentes</mat-error>
          </mat-form-field>
        </div>
        <div formArrayName="securityQuestions" #formSection class="form-section" data-sectionTitle="Perguntas de Segurança">
          <ng-container *ngFor="let ctrl of getSecurityQuestions().controls; index as idx">
            <div [formGroupName]="idx">
              <mat-form-field appearance="outline">
                <mat-label>Pergunta</mat-label>
                <input type="text" matInput formControlName="question" />
                <mat-error *ngIf="getSecurityQuestion(idx,'question').hasError('required')">Campo obrigatório</mat-error>
                <mat-error *ngIf="getSecurityQuestion(idx,'question').hasError('minlength')">Um mínimo de 6 caracteres é necessário</mat-error>
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>Resposta</mat-label>
                <input type="text" matInput formControlName="answer" />
                <mat-error *ngIf="getSecurityQuestion(idx, 'answer').hasError('required')">Campo obrigatório</mat-error>
              </mat-form-field>
            </div>
          </ng-container>
        </div>
      </form>
    </div>
    <div class="footer-content">
      <button mat-button (click)="signIn()">Iniciar Sessão</button>
      <div class="controls">
        <button mat-button (click)="previousSection()" *ngIf="!hidePrevious">Voltar</button>
        <button mat-flat-button (click)="nextSection()" color="accent" *ngIf="hideFinish">Avançar</button>
        <button mat-flat-button color="accent" *ngIf="!hideFinish" (click)="signUp()">Concluir</button>
      </div>
    </div>
  </mat-card>
</div>
